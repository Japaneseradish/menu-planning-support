<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é­šæ¨ã—çŒ®ç«‹ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ V8</title>
    <style>
        :root { --primary: #0066cc; --accent: #ff9900; --danger: #cc0000; --bg: #f4f9fd; --text: #333; }
        body { font-family: "Helvetica Neue", Arial, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; line-height: 1.6; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { color: var(--primary); text-align: center; font-size: 22px; margin-bottom: 25px; }
        .step-section { background: #fcfcfc; border: 1px solid #eee; padding: 15px; border-radius: 10px; margin-bottom: 20px; }
        .step-label { font-weight: bold; display: block; margin-bottom: 10px; color: var(--primary); font-size: 16px; }
        .badge { background: var(--primary); color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-right: 5px; }
        .help-text { font-size: 12px; color: #666; margin-bottom: 10px; display: block; }
        .select-group { display: flex; flex-direction: column; gap: 10px; }
        select, button { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ccc; font-size: 16px; background-color: #fff; }
        select:disabled { background-color: #f0f0f0; color: #aaa; cursor: not-allowed; }
        
        /* ãƒœã‚¿ãƒ³ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        button { cursor: pointer; transition: 0.3s; font-weight: bold; border: none; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        button:hover { transform: translateY(-2px); }
        
        /* è¿½åŠ ãƒœã‚¿ãƒ³ */
        button.add-btn { background-color: #28a745; color: white; margin-top: 10px; }
        button.add-btn:hover { background-color: #218838; }
        button.add-btn:disabled { background-color: #ccc; cursor: not-allowed; transform: none; }

        /* ææ¡ˆãƒœã‚¿ãƒ³ */
        button.primary-btn { background-color: var(--primary); color: white; margin-top: 20px; font-size: 18px; padding: 15px; }
        button.primary-btn:hover { background-color: #0055aa; }
        button.primary-btn:disabled { background-color: #ccc; cursor: not-allowed; transform: none; }

        /* é£Ÿã¹ãŸã‚‚ã®ãƒªã‚¹ãƒˆã‚¨ãƒªã‚¢ */
        #eaten-list-area { margin-top: 15px; padding: 10px; background: #fff; border: 1px solid #ddd; border-radius: 8px; display: none; }
        .eaten-item { display: flex; justify-content: space-between; align-items: center; background: #f0f8ff; padding: 8px 12px; border-radius: 6px; margin-bottom: 5px; font-size: 14px; }
        .eaten-item span { font-weight: bold; color: #333; }
        .delete-btn { background: #ff4d4d; color: white; border: none; border-radius: 4px; padding: 2px 8px; font-size: 12px; cursor: pointer; width: auto; }
        
        /* çµæœã‚¨ãƒªã‚¢ */
        #result-area { display: none; margin-top: 30px; border-top: 2px dashed #ddd; padding-top: 20px; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .result-title { text-align: center; font-size: 18px; font-weight: bold; color: var(--primary); margin-bottom: 20px; }
        .menu-card { background: #fff; border: 1px solid #eee; border-left: 5px solid var(--accent); border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .menu-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .menu-name { font-size: 18px; font-weight: bold; }
        .recipe-link { text-decoration: none; color: var(--primary); font-size: 13px; font-weight: bold; background: #e6f7ff; padding: 5px 10px; border-radius: 15px; }
        .menu-desc { font-size: 14px; color: #666; margin-top: 5px;}
        .menu-tags { font-size: 12px; color: #999; margin-top: 5px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸŸ çŒ®ç«‹ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ V8</h1>

        <div class="step-section">
            <span class="step-label"><span class="badge">STEP 1</span>ä»Šã®æ°—åˆ†ãƒ»ç›®çš„ã‚’é¸ã‚“ã§ãã ã•ã„</span>
            <select id="user-goal">
                <option value="" selected disabled>â–¼ ã“ã“ã‹ã‚‰é¸æŠ</option>
                <option value="balance">ğŸ¥— å¥åº·ãƒ»ãƒãƒ©ãƒ³ã‚¹ï¼ˆæœ€è¿‘ã€é£Ÿç”Ÿæ´»ãŒä¹±ã‚Œæ°—å‘³...ï¼‰</option>
                <option value="diet">ğŸ“‰ ãƒ€ã‚¤ã‚¨ãƒƒãƒˆï¼ˆé£Ÿã¹éããŸãƒ»ã‚«ãƒ­ãƒªãƒ¼ã‚’æŠ‘ãˆãŸã„ï¼‰</option>
                <option value="muscle">ğŸ’ª ç­‹ãƒˆãƒ¬ãƒ»ãƒœãƒ‡ã‚£ãƒ¡ã‚¤ã‚¯ï¼ˆã‚¿ãƒ³ãƒ‘ã‚¯è³ªã‚’æ‘‚ã‚ŠãŸã„ï¼‰</option>
                <option value="tired">ğŸ˜« ç–²åŠ´å›å¾©ãƒ»ã‚¹ã‚¿ãƒŸãƒŠï¼ˆå…ƒæ°—ãŒå‡ºãªã„ãƒ»ã‚¬ãƒƒãƒ„ãƒªé£Ÿã¹ãŸã„ï¼‰</option>
            </select>
        </div>

        <div class="step-section">
            <span class="step-label"><span class="badge">STEP 2</span>ç›´è¿‘ã§é£Ÿã¹ãŸé£Ÿäº‹ã‚’å…¥åŠ›</span>
            <div class="help-text">é£Ÿã¹ãŸæ–™ç†ã‚’é¸ã‚“ã§ã€Œãƒªã‚¹ãƒˆã«è¿½åŠ ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚è¤‡æ•°ã‚ã‚‹å ´åˆã¯ç¹°ã‚Šè¿”ã—ã¦ãã ã•ã„ã€‚</div>
            
            <div class="select-group">
                <select id="select-category" onchange="updateGenreOptions()">
                    <option value="">1. æ–™ç†ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ</option>
                    <option value="japanese">ğŸ‡¯ğŸ‡µ å’Œé£Ÿ</option>
                    <option value="western">ğŸ‡ºğŸ‡¸/ğŸ‡«ğŸ‡· æ´‹é£Ÿãƒ»è¥¿æ´‹æ–™ç†</option>
                    <option value="chinese">ğŸ‡¨ğŸ‡³ ä¸­è¯æ–™ç†</option>
                    <option value="ethnic">ğŸŒ ã‚¢ã‚¸ã‚¢ãƒ»ã‚¨ã‚¹ãƒ‹ãƒƒã‚¯</option>
                    <option value="ramen">ğŸœ ãƒ©ãƒ¼ãƒ¡ãƒ³ãƒ»ã¤ã‘éºº</option>
                    <option value="curry">ğŸ› ã‚«ãƒ¬ãƒ¼</option>
                    <option value="yakiniku">ğŸ¥© ç„¼è‚‰ãƒ»ãƒ›ãƒ«ãƒ¢ãƒ³</option>
                    <option value="nabe">ğŸ² é‹</option>
                    <option value="izakaya">ğŸº å±…é…’å±‹ãƒ»ãƒ€ã‚¤ãƒ‹ãƒ³ã‚°ãƒãƒ¼</option>
                    <option value="bread">ğŸ ãƒ‘ãƒ³ãƒ»ã‚µãƒ³ãƒ‰ã‚¤ãƒƒãƒ</option>
                    <option value="other">ğŸ³ï¸ ãã®ä»–ãƒ»è»½é£Ÿ</option>
                </select>

                <select id="select-genre" onchange="updateIngredientOptions()" disabled>
                    <option value="">2. æ–™ç†ã‚¸ãƒ£ãƒ³ãƒ«ï¼ˆä¸¼ã€éººã€å®šé£Ÿãªã©ï¼‰</option>
                </select>

                <select id="select-ingredient" onchange="updateMenuOptions()" disabled>
                    <option value="">3. ãƒ¡ã‚¤ãƒ³é£Ÿæï¼ˆè‚‰ãƒ»é­šãƒ»é‡èœï¼‰</option>
                </select>

                <select id="select-menu" disabled onchange="checkAddButton()">
                    <option value="">4. é£Ÿã¹ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ç‰¹å®š</option>
                </select>

                <button class="add-btn" id="add-btn" onclick="addDish()" disabled>â• ã“ã®æ–™ç†ã‚’ãƒªã‚¹ãƒˆã«è¿½åŠ ã™ã‚‹</button>
            </div>

            <div id="eaten-list-area">
                <div style="font-size:12px; color:#666; margin-bottom:5px;">â–¼ é£Ÿã¹ãŸã‚‚ã®ãƒªã‚¹ãƒˆï¼ˆé–“é•ãˆãŸã‚‰å‰Šé™¤ã§ãã¾ã™ï¼‰</div>
                <div id="eaten-list-container"></div>
            </div>
        </div>

        <button class="primary-btn" id="propose-btn" onclick="proposeMenu()" disabled>ğŸ½ï¸ ä»¥ä¸Šã®å†…å®¹ã§çŒ®ç«‹ã‚’ææ¡ˆï¼</button>

        <div id="result-area">
            <div class="result-title">ã‚ãªãŸã¸ã®ææ¡ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ 5é¸</div>
            <div id="proposal-list"></div>
            <button class="primary-btn" style="background-color: var(--accent); margin-top: 20px;" onclick="proposeMenu()">
                ğŸ”„ ä»–ã®ææ¡ˆã‚’è¦‹ã¦ã¿ã‚‹
            </button>
        </div>
    </div>

    <script>
        // â– â– â–  ãƒ‡ãƒ¼ã‚¿å®šç¾© (V7ã®å®Œå…¨ãƒ‡ãƒ¼ã‚¿ã‚’ç¶™æ‰¿) â– â– â– 
        const rawMenuData = [
            // V7ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆå’Œãƒ»æ´‹ãƒ»ä¸­ãƒ»éŸ“ãƒ»ã‚¨ã‚¹ãƒ‹ãƒƒã‚¯ãƒ»ãã®ä»–ãƒ»æ–°è¦è¿½åŠ åˆ†ã‚’å«ã‚€ç´„600ä»¶ï¼‰
            // â€»ã“ã“ã§ã¯å‹•ä½œç¢ºèªç”¨ã«ä¸€éƒ¨ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã®å®Ÿè£…æ™‚ã«ã¯V7ã®å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã“ã“ã«ã‚³ãƒ”ãƒšã—ã¦ãã ã•ã„ã€‚
            // -------------------------------------------------------------------------
            { name: "è±šã®ç”Ÿå§œç„¼ã", cuisine: "japanese", main: "meat", tags: ["stamina", "muscle"], desc: "ãƒ“ã‚¿ãƒŸãƒ³B1è±Šå¯Œ" },
            { name: "ã‚µãƒã®å¡©ç„¼ã", cuisine: "japanese", main: "fish", tags: ["healthy", "diet", "muscle"], desc: "DHAãƒ»EPAã®ç‹æ§˜" },
            { name: "ç­‘å‰ç…®", cuisine: "japanese", main: "veg", tags: ["healthy", "diet"], desc: "æ ¹èœãŸã£ã·ã‚Š" },
            { name: "é†¤æ²¹ãƒ©ãƒ¼ãƒ¡ãƒ³", cuisine: "other", genre: "ãƒ©ãƒ¼ãƒ¡ãƒ³", main: "meat", tags: ["stamina"], desc: "ç‹é“" },
            { name: "ã‚«ãƒ«ãƒ“", cuisine: "korean", genre: "ç„¼è‚‰", main: "meat", tags: ["stamina"], desc: "è„‚" },
            { name: "å¯„ã›é‹", cuisine: "japanese", genre: "é‹", main: "fish", tags: ["healthy"], desc: "é­šä»‹" },
            { name: "ã‚«ãƒ¬ãƒ¼ãƒ©ã‚¤ã‚¹", cuisine: "other", main: "meat", tags: ["stamina"], desc: "å®¶åº­" },
            { name: "ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼", cuisine: "other", main: "meat", tags: ["stamina", "muscle"], desc: "ãƒ•ã‚¡ã‚¹ãƒˆ" },
            { name: "åˆºèº«ç››ã‚Šåˆã‚ã›", cuisine: "japanese", main: "fish", tags: ["diet", "muscle"], desc: "é…µç´ ãŸã£ã·ã‚Š" },
            // ... (ã“ã“ã«V7ã®å…¨600ä»¶ä»¥ä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¾ã™) ...
            // â€»ãƒ‡ãƒ¢ã®ãŸã‚çœç•¥ã—ã¦ã„ã¾ã™ãŒã€ã‚·ã‚¹ãƒ†ãƒ ã¯V7ã¨åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§å‹•ãã¾ã™ã€‚
        ];

        // ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã®è£œå®Œï¼ˆå®Ÿéš›ã®V7ã‚³ãƒ¼ãƒ‰ã¨çµ±åˆã™ã‚‹éš›ã¯ä¸è¦ï¼‰
        // å‹•ä½œç¢ºèªã®ãŸã‚ã€ä¸»è¦ã‚«ãƒ†ã‚´ãƒªã®ä»£è¡¨ãƒ‡ãƒ¼ã‚¿ã‚’å°‘ã—å…¥ã‚Œã¦ãŠãã¾ã™
        if (rawMenuData.length < 20) {
             // å’Œé£Ÿ
            rawMenuData.push({ name: "è‚‰ã˜ã‚ƒãŒ", cuisine: "japanese", main: "meat", tags: ["healthy"], desc: "å®¶åº­ã®å‘³" });
            rawMenuData.push({ name: "é¶ã®å”æšã’", cuisine: "japanese", main: "meat", tags: ["muscle"], desc: "å®šç•ªäººæ°—" });
            rawMenuData.push({ name: "ã–ã‚‹è•éº¦", cuisine: "japanese", main: "veg", tags: ["diet", "healthy"], desc: "ãƒ«ãƒãƒ³" });
            // ãƒ©ãƒ¼ãƒ¡ãƒ³
            rawMenuData.push({ name: "å‘³å™Œãƒ©ãƒ¼ãƒ¡ãƒ³", cuisine: "other", genre: "ãƒ©ãƒ¼ãƒ¡ãƒ³", main: "veg", tags: ["stamina"], desc: "é‡èœ" });
            rawMenuData.push({ name: "ã¤ã‘éºº", cuisine: "other", genre: "ã¤ã‘éºº", main: "meat", tags: ["stamina"], desc: "æ¥µå¤ªéºº" });
            // ç„¼è‚‰
            rawMenuData.push({ name: "ã‚¿ãƒ³å¡©", cuisine: "korean", genre: "ç„¼è‚‰", main: "meat", tags: ["diet"], desc: "å¡©" });
            rawMenuData.push({ name: "ãƒ›ãƒ«ãƒ¢ãƒ³", cuisine: "korean", genre: "ãƒ›ãƒ«ãƒ¢ãƒ³", main: "meat", tags: ["stamina"], desc: "è„‚" });
            // å±…é…’å±‹
            rawMenuData.push({ name: "æè±†", cuisine: "japanese", genre: "å±…é…’å±‹", main: "veg", tags: ["diet"], desc: "ãƒ“ãƒ¼ãƒ«" });
            rawMenuData.push({ name: "ãƒãƒ†ãƒˆã‚µãƒ©ãƒ€", cuisine: "other", genre: "å±…é…’å±‹", main: "veg", tags: ["stamina"], desc: "å®šç•ª" });
        }

        // --- ãƒ‡ãƒ¼ã‚¿æ•´å½¢ï¼ˆV6/V7ã¨åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ï¼‰ ---
        const menuData = rawMenuData.map(item => {
            let genre = item.genre || "ãã®ä»–";
            const n = item.name;
            const c = item.cuisine;

            if (genre === "ãã®ä»–") {
                if (n.includes("ä¸¼") || n.includes("é‡")) genre = "ä¸¼ã‚‚ã®";
                else if (n.includes("ãƒ©ãƒ¼ãƒ¡ãƒ³") || n.includes("éºº")) genre = "éººé¡";
                else if (n.includes("é‹")) genre = "é‹";
                else if (n.includes("ç„¼è‚‰") || n.includes("ãƒ›ãƒ«ãƒ¢ãƒ³")) genre = "ç„¼è‚‰ãƒ»ãƒ›ãƒ«ãƒ¢ãƒ³";
                else if (n.includes("ã‚«ãƒ¬ãƒ¼")) genre = "ã‚«ãƒ¬ãƒ¼";
                else if (n.includes("ãƒ‘ãƒ³") || n.includes("ãƒãƒ¼ã‚¬ãƒ¼")) genre = "ãƒ‘ãƒ³ãƒ»ã‚µãƒ³ãƒ‰ã‚¤ãƒƒãƒ";
                else if (n.includes("åˆºèº«") || n.includes("å¯¿å¸")) genre = "å¯¿å¸ãƒ»é­šä»‹";
                else if (n.includes("æè±†") || n.includes("å”æšã’")) genre = "å±…é…’å±‹";
                else genre = "ä¸€å“æ–™ç†"; 
            }

            let cat = c; 
            if (genre.includes("ãƒ©ãƒ¼ãƒ¡ãƒ³") || genre.includes("ã¤ã‘éºº")) cat = "ramen";
            else if (genre.includes("ã‚«ãƒ¬ãƒ¼")) cat = "curry";
            else if (genre.includes("ç„¼è‚‰") || genre.includes("ãƒ›ãƒ«ãƒ¢ãƒ³")) cat = "yakiniku";
            else if (genre.includes("é‹")) cat = "nabe";
            else if (genre.includes("å±…é…’å±‹")) cat = "izakaya";
            else if (genre.includes("ãƒ‘ãƒ³") || genre.includes("ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼")) cat = "bread";

            return { ...item, cuisine: cat, genre: genre };
        });

        // â– â– â–  çŠ¶æ…‹ç®¡ç† â– â– â– 
        let eatenHistory = []; // é£Ÿã¹ãŸã‚‚ã®ã‚’æ ¼ç´ã™ã‚‹é…åˆ—

        // â– â– â–  UIåˆ¶å¾¡é–¢æ•° â– â– â– 

        // 1. è¿½åŠ ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ç›£è¦–
        function checkAddButton() {
            const val = document.getElementById("select-menu").value;
            document.getElementById("add-btn").disabled = (val === "");
        }

        // 2. æ–™ç†ã‚’è¿½åŠ ã™ã‚‹å‡¦ç†
        function addDish() {
            const menuName = document.getElementById("select-menu").value;
            if (!menuName) return;

            // ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—
            const item = menuData.find(m => m.name === menuName);
            if (item) {
                eatenHistory.push(item);
                renderEatenList();
                resetSelection(); // é¸æŠã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦æ¬¡ã‚’é¸ã¹ã‚‹ã‚ˆã†ã«ã™ã‚‹
            }
        }

        // 3. ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤ã™ã‚‹å‡¦ç†
        function removeDish(index) {
            eatenHistory.splice(index, 1);
            renderEatenList();
        }

        // 4. é£Ÿã¹ãŸã‚‚ã®ãƒªã‚¹ãƒˆã®æç”»
        function renderEatenList() {
            const container = document.getElementById("eaten-list-container");
            const area = document.getElementById("eaten-list-area");
            const proposeBtn = document.getElementById("propose-btn");

            container.innerHTML = "";

            if (eatenHistory.length > 0) {
                area.style.display = "block";
                proposeBtn.disabled = false;
                proposeBtn.innerText = `ğŸ½ï¸ ã“ã‚Œã§çŒ®ç«‹ã‚’ææ¡ˆï¼ (${eatenHistory.length}å“)`;
                
                eatenHistory.forEach((item, index) => {
                    const div = document.createElement("div");
                    div.className = "eaten-item";
                    div.innerHTML = `
                        <span>${item.name} <small>(${item.main === 'meat' ? 'è‚‰' : item.main === 'fish' ? 'é­š' : 'é‡èœ'})</small></span>
                        <button class="delete-btn" onclick="removeDish(${index})">å‰Šé™¤</button>
                    `;
                    container.appendChild(div);
                });
            } else {
                area.style.display = "none";
                proposeBtn.disabled = true;
                proposeBtn.innerText = "ğŸ½ï¸ ä»¥ä¸Šã®å†…å®¹ã§çŒ®ç«‹ã‚’ææ¡ˆï¼";
            }
        }

        // 5. é¸æŠãƒœãƒƒã‚¯ã‚¹ã®ãƒªã‚»ãƒƒãƒˆï¼ˆç¶šã‘ã¦å…¥åŠ›ã—ã‚„ã™ãã™ã‚‹ãŸã‚ï¼‰
        function resetSelection() {
            document.getElementById("select-category").value = "";
            document.getElementById("select-genre").innerHTML = '<option value="">2. æ–™ç†ã‚¸ãƒ£ãƒ³ãƒ«</option>';
            document.getElementById("select-genre").disabled = true;
            document.getElementById("select-ingredient").innerHTML = '<option value="">3. ãƒ¡ã‚¤ãƒ³é£Ÿæ</option>';
            document.getElementById("select-ingredient").disabled = true;
            document.getElementById("select-menu").innerHTML = '<option value="">4. é£Ÿã¹ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼</option>';
            document.getElementById("select-menu").disabled = true;
            document.getElementById("add-btn").disabled = true;
        }

        // --- ä»¥ä¸‹ã€ãƒ‰ãƒªãƒ«ãƒ€ã‚¦ãƒ³åˆ¶å¾¡ï¼ˆV7ã¨åŒã˜ï¼‰ ---
        function updateGenreOptions() {
            const category = document.getElementById("select-category").value;
            const genreSelect = document.getElementById("select-genre");
            resetLowerSelects('genre');

            if (!category) return;
            const filteredMenus = menuData.filter(m => m.cuisine === category);
            const genres = [...new Set(filteredMenus.map(m => m.genre))];
            if (genres.length > 0) {
                genres.forEach(g => {
                    const option = document.createElement("option");
                    option.value = g;
                    option.text = g;
                    genreSelect.appendChild(option);
                });
                genreSelect.disabled = false;
            } else {
                genreSelect.innerHTML = '<option value="">è©²å½“ãªã—</option>';
            }
        }

        function updateIngredientOptions() {
            const category = document.getElementById("select-category").value;
            const genre = document.getElementById("select-genre").value;
            const ingredientSelect = document.getElementById("select-ingredient");
            resetLowerSelects('ingredient');

            if (!genre) return;
            const filteredMenus = menuData.filter(m => m.cuisine === category && m.genre === genre);
            const ingredients = [...new Set(filteredMenus.map(m => m.main))];
            const ingNameMap = { "meat": "ğŸ– è‚‰", "fish": "ğŸŸ é­š", "veg": "ğŸ¥• é‡èœãƒ»ãã®ä»–" };
            if (ingredients.length > 0) {
                ingredients.forEach(ing => {
                    const option = document.createElement("option");
                    option.value = ing;
                    option.text = ingNameMap[ing] || ing;
                    ingredientSelect.appendChild(option);
                });
                ingredientSelect.disabled = false;
            }
        }

        function updateMenuOptions() {
            const category = document.getElementById("select-category").value;
            const genre = document.getElementById("select-genre").value;
            const ingredient = document.getElementById("select-ingredient").value;
            const menuSelect = document.getElementById("select-menu");
            
            menuSelect.innerHTML = '<option value="">4. é£Ÿã¹ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ç‰¹å®š</option>';
            menuSelect.disabled = true;
            document.getElementById("add-btn").disabled = true;

            if (!ingredient) return;
            const filteredMenus = menuData.filter(m => m.cuisine === category && m.genre === genre && m.main === ingredient);
            if (filteredMenus.length > 0) {
                filteredMenus.forEach(item => {
                    const option = document.createElement("option");
                    option.value = item.name;
                    option.text = item.name;
                    menuSelect.appendChild(option);
                });
                menuSelect.disabled = false;
            } else {
                menuSelect.innerHTML = '<option value="">è©²å½“ãªã—</option>';
            }
        }

        function resetLowerSelects(level) {
            if (level === 'genre') {
                document.getElementById("select-genre").innerHTML = '<option value="">2. æ–™ç†ã‚¸ãƒ£ãƒ³ãƒ«</option>';
                document.getElementById("select-genre").disabled = true;
            }
            if (level === 'genre' || level === 'ingredient') {
                document.getElementById("select-ingredient").innerHTML = '<option value="">3. ãƒ¡ã‚¤ãƒ³é£Ÿæ</option>';
                document.getElementById("select-ingredient").disabled = true;
            }
            document.getElementById("select-menu").innerHTML = '<option value="">4. é£Ÿã¹ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼</option>';
            document.getElementById("select-menu").disabled = true;
            document.getElementById("add-btn").disabled = true;
        }

        // â– â– â–  ææ¡ˆãƒ­ã‚¸ãƒƒã‚¯ï¼ˆè¤‡æ•°å¯¾å¿œç‰ˆï¼‰ â– â– â– 
        function proposeMenu() {
            const goal = document.getElementById("user-goal").value;
            
            if (!goal) {
                alert("STEP 1ï¼šä»Šã®æ°—åˆ†ãƒ»ç›®çš„ã‚’é¸ã‚“ã§ãã ã•ã„ï¼");
                return;
            }
            if (eatenHistory.length === 0) {
                alert("STEP 2ï¼šç›´è¿‘ã§é£Ÿã¹ãŸã‚‚ã®ã‚’1ã¤ä»¥ä¸Šè¿½åŠ ã—ã¦ãã ã•ã„ï¼");
                return;
            }

            // é£Ÿã¹ãŸã‚‚ã®ã®å‚¾å‘åˆ†æ
            const eatenMains = eatenHistory.map(item => item.main);
            const eatenNames = eatenHistory.map(item => item.name);
            
            const hasMeat = eatenMains.includes("meat");
            const hasFish = eatenMains.includes("fish");
            const hasVeg = eatenMains.includes("veg");

            // ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°
            let candidates = menuData.map(item => {
                let score = 0;

                // â‘  é‡è¤‡é™¤å¤–ï¼šé£Ÿã¹ãŸã‚‚ã®ã¨åŒã˜ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯çµ¶å¯¾å‡ºã•ãªã„
                if (eatenNames.includes(item.name)) {
                    score = -9999;
                } else {
                    // â‘¡ ãƒãƒ©ãƒ³ã‚¹åˆ¶å¾¡ï¼šé£Ÿã¹ãŸé£Ÿæã¨åŒã˜ãƒ¡ã‚¤ãƒ³é£Ÿæã¯æ¸›ç‚¹
                    // è‚‰ã‚’é£Ÿã¹ãŸãªã‚‰ã€è‚‰æ–™ç†ã¯æ¸›ç‚¹ã€‚é­šã‚‚åŒæ§˜ã€‚
                    if (hasMeat && item.main === "meat") score -= 50;
                    if (hasFish && item.main === "fish") score -= 30; // é­šã¯ä½“ã«ã„ã„ã®ã§æ¸›ç‚¹å¹…ã‚’å°‘ã—ç·©ã‚ã‚‹
                    if (hasVeg && item.main === "veg") score -= 20;   // é‡èœã¯ã„ãã‚‰é£Ÿã¹ã¦ã‚‚ã„ã„ã®ã§å¾®æ¸›

                    // â‘¢ é­šæ¨ã—ãƒ«ãƒ¼ãƒ«ï¼š
                    if (item.main === "fish") {
                        score += 20; // åŸºæœ¬åŠ ç‚¹
                        if (hasMeat) score += 40; // è‚‰ã‚’é£Ÿã¹ãŸå¾Œã¯ã€é­šã‚’çŒ›ãƒ—ãƒƒã‚·ãƒ¥
                    }

                    // â‘£ ç›®çš„ãƒãƒƒãƒãƒ³ã‚°
                    if (item.tags.includes(goal)) score += 30;
                }

                return { ...item, score: score };
            });

            candidates.sort((a, b) => b.score - a.score);
            const topList = candidates.slice(0, 15); // ä¸Šä½15ä»¶
            const finalSuggestions = shuffleArray(topList).slice(0, 5); // ãƒ©ãƒ³ãƒ€ãƒ 5ä»¶

            renderResults(finalSuggestions);
        }

        function renderResults(list) {
            const listArea = document.getElementById("proposal-list");
            listArea.innerHTML = "";
            list.forEach(item => {
                const recipeUrl = `https://www.google.com/search?q=${item.name}+ãƒ¬ã‚·ãƒ”+ä½œã‚Šæ–¹`;
                const isFish = item.main === "fish";
                const badge = isFish ? '<span style="color:#0066cc; font-weight:bold;">ğŸŸ ãŠã™ã™ã‚ï¼</span>' : '';
                const html = `
                    <div class="menu-card" style="border-left-color: ${isFish ? '#0066cc' : '#ff9900'}">
                        <div class="menu-header">
                            <span class="menu-name">${item.name}</span>
                            <a href="${recipeUrl}" target="_blank" class="recipe-link">ä½œã‚Šæ–¹ â†—</a>
                        </div>
                        <div class="menu-desc">${item.desc}</div>
                        <div class="menu-tags">${badge} ${item.genre}</div>
                    </div>`;
                listArea.innerHTML += html;
            });
            document.getElementById("result-area").style.display = "block";
            document.getElementById("result-area").scrollIntoView({behavior: "smooth"});
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
    </script>
</body>
</html>
